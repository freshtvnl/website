{{ $site := .site }}
{{ $page := .page }}
{{ $params := .params }}
{{ $align := .params.align }}
{{ $display := .params.displaymedia }}
{{ $optBlock := dict "display" "block" }}
{{ $textalign :=  (cond (ne ($params.align_text) nil ) (.params.align_text) ("text-left") ) }}


<div class="px-6 py-8 mx-auto max-w-screen-2xl lg:px-8 xl:px-24">
  <div class="mb-12 lg:mb-20 xl:mb-32 ">
    <div class="grid md:grid-cols-5 md:gap-x-24 {{if eq $align "right" }}md:grid-flow-col-dense{{end}}">
      <div class="col-span-5 {{if eq $align "center" }}md:col-span-5 mx-auto{{else}}md:col-span-2{{end}} {{if eq $align "right"}}md:col-start-4{{end}} prose lg:prose-lg xl:prose-xl py-6 md:py-2 w-full {{$textalign}}">
        
       
        {{ $markdown := $params.content  | markdownify }}
        {{ if not ( strings.Contains $markdown "<p>" ) }}
            <p>{{ $markdown }}</p>
        {{ else }}
            {{ $markdown }}
        {{ end }}

        {{ with $params.cta }}
        {{ $color := .color}}
        <div class="mt-6">
          {{ if eq .type "button" }}
            {{ if $color}}
            <a href="{{.url}}" class="inline-block px-4 py-4 leading-none text-white transition duration-200 bg-{{$color}}-500 hover:opacity-80" style="color: white !important; text-decoration: none !important;">{{.text}}</a>
            {{ else }}
            <a href="{{.url}}" class="inline-block px-4 py-4 leading-none text-white transition duration-200 branch-element-bg hover:opacity-80" style="color: white !important; text-decoration: none !important;">{{.text}}</a>
            {{ end }}
          {{ else }}
            {{ if $color}}
            <a href="{{.url}}" class="text-{{$color}}-500">{{.text}}</a>
            {{ else }}
            <a href="{{.url}}" class="branch-element-text">{{.text}}</a>
            {{ end }}
          {{ end }}
        </div>
        {{ end}}

        {{ if not (eq $display "form") }}
        
        {{ with $params.form }}
          {{ range where $site.Pages "Params.slug" . }}
          {{ $item := . }}
            {{ partial "form.html" (dict "page" $page "data" . "site" $site ) }}
          {{ end }}
        {{ end }}

        {{ end }}
     
      </div>
      <div class="col-span-5 md:col-span-3">
        {{ if  (eq $display "form") }}
        
        {{ with $params.form }}
          {{ range where $site.Pages "Params.slug" . }}
          {{ $item := . }}
            {{ partial "form.html" (dict "page" $page "data" . "site" $site ) }}
          {{ end }}
        {{ end }}

        {{ end }}
     

        {{ if and ($params.video) (eq $display "custom_video") }}
        <div class="relative">
          <video {{ if $params.video.autoplay}}autoplay muted loop playsinline{{else}}controls{{end}} class="w-full focus:outline-none">
            {{ with  $params.video.source_webm }}
              <source src="{{.}}" type="video/webm">
            {{ end }}
            {{ with  $params.video.source_mp4 }}
            <source src="{{.}}" type="video/mp4">
            {{ end }}
          </video>

          {{ if $params.video.image }}
            <button class="absolute inset-0 z-30 flex items-center justify-center w-full pr-6 playbutton focus:outline-none">
              <span class="relative z-30 flex items-center justify-center w-16 h-16 text-white rounded branch-element-bg animate-pulse duration-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
              </span>
              {{ partial "image.html" (dict "page" $page "source" $params.video.image.source "alt" $params.video.image.alt "width" "1600" "height" "900" "class" "w-full z-20 absolute inset-0 z-10") }}
            </button>
          {{ end }}
        </div>
      {{ end }}

      {{ if and ($params.iframe) (eq $display "iframe") }}
      <div class="video-wrapper">
        <iframe src="{{$params.iframe.source}}" frameborder="0"></iframe>
      </div>
      {{ end}}
      
      {{ if and ($params.image) (eq $display "image") }}
        {{ if $params.fullwidth }}
        {{ partial "image.html" (dict "page" $page "source" $params.image.source "alt" $params.image.alt "width" "1600" "height" "700" "class" "") }}
        {{ else }}
        {{ partial "image.html" (dict "page" $page "source" $params.image.source "alt" $params.image.alt "width" "930" "height" "500" "class" "") }}
        {{ end }}
      {{ end }}
  
      {{ if and ($params.youtube) (eq $display "youtube_video") }}
        {{ with $params.youtube.id}}
        <div class="video-wrapper">
          <div id="player-{{. | urlize}}" data-video="{{.}}" class="videoplayer"></div>
        </div>
        {{ end }}
      {{ end }}
      </div>
    </div>
  </div>
</div>